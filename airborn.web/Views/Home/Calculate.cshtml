@using Airborn.web.Models
@model ScenarioPageModel

@{
    ViewData["Title"] = "Free takeoff and landing distance calculator: C172, SR22, SR22T | Airborn.co";
}

<br />

<form asp-action="Calculate" method="post" class="form-horizontal">

    <br />
    <h4><b>Airborn</b> is a free takeoff and landing distance calculator</h4>
    Tell us your about your flight, and we'll tell you how much runway "the book" says you'll need to takeoff and land.
    <br />

    @Html.ValidationSummary(false, "", new { @class = "text-danger" })
    <br />

    <div>
        <h6>The flight</h6>
    </div>
    <div class="form-group row">
        <div class="col-sm-3">
            <div class="form-floating">
                
                <select asp-for="AircraftType" class="form-select">
                    <option value="SR22_G2">Cirrus SR22 G2</option>
                    <option value="SR22T_G5">Cirrus SR22T G5</option>
                    <option value="C172_SP">Cessna 172SP</option>
                </select>
                <label for="AircraftType">Aircraft type</label>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="form-floating">
                <input asp-for="AircraftWeight" class="form-control" maxlength="10"
                    placeholder="Aircraft weight" data-val-required="Aircraft weight is required"/>
                <label for="AircraftWeight">Aircraft weight (lbs)</label>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="form-floating">
                <input asp-for="AirportIdentifier" class="form-control" autocomplete="off" id="AirportIdentifier"
                    data-val-required="Airport identifier is required"
                    />
                <label asp-for="AirportIdentifier">Airport</label>
            </div>
        </div>

    </div>
    
    <br />
   <div>
        <h6>The weather</h6>
    </div>
    <div class="form-group row">
        <div class="col-sm-3">
            <div class="form-floating">  
            <input asp-for="WindDirectionMagnetic" class="form-control" maxlength="3" />
            <label asp-for="WindDirectionMagnetic">Wind direction °M</label>
            </div>
        </div>  
        <div class="col-sm-3">
            <div class="form-floating">
                <input asp-for="WindStrength" class="form-control" maxlength="3" />
                <label asp-for="WindStrength">Wind strength (kts)</label>
            </div>
        </div>
        <div class="col-sm-2">
            <div class="form-floating">   
                <input asp-for="Temperature" class="form-control" maxlength="2" />
                <label asp-for="Temperature">Temperature</label>
            </div>
        </div>
        <div class="col-sm-1">
            <div class="form-floating"> 
                <select style="width:auto;" asp-for="TemperatureType" class="form-control" >
                    <option value="C">°C</option>
                    <option value="F">°F</option>
                </select>            
            </div>
        </div>             

        <div class="col-sm-2">
            <div class="form-floating">           
                <input asp-for="AltimeterSetting" class="form-control" maxlength="5" />
                <label asp-for="AltimeterSetting">Altimeter setting</label>
            </div>
        </div>
        <div class="col-sm-1">
            <div class="form-floating"> 
                <select style="width:auto;" asp-for="AltimeterSettingType" class="form-control" >
                    <option value="MB">mb</option>
                    <option value="HG">Hg</option>
                </select>
            </div>
        </div>           
    </div>    
    
    <br />
    <div>
        <h6>The airport</h6>
    </div>
    <div class="form-group row">

        <div class="col-sm-3">
            <div class="form-floating">
                <select asp-for="RunwayIdentifier" class="form-control" >
                    @foreach (Runway runway in Model?.Runways) 
                        {<option value="@runway.RunwayIdentifier_Primary">@runway.RunwayIdentifier_Primary</option>
                        <option value="@runway.RunwayIdentifier_Secondary">@runway.RunwayIdentifier_Secondary</option>}
                    
                </select>
                <label asp-for="RunwayIdentifier">Runway</label>
            </div>
        </div>

            @section Scripts{
                <script>
                    $(document).ready(function () {
                        $('#AirportIdentifier').autocomplete({
                            source: '/Home/AutocompleteAirportIdentifier',
                            minLength: 2,
                            select: function (event, ui) {

                            $.ajax({  
                                type: "POST",  
                                url: "/Home/PopulateRunways?airportIdentifier=" + ui.item.label,  
                                data: "{}",  
                                success: function (data) {  
                                    var s = '<option value="-1">Select...</option>';  
                                    for (var i = 0; i < data.length; i++) {  
                                        s += '<option value="' + data[i].label + '">' + data[i].label + '</option>';  
                                    }  
                                    $("#RunwayIdentifier").html(s);  

                                $.ajax({  
                                    type: "POST",  
                                    url: "/Home/GetAirportInformation?airportIdentifier=" + ui.item.label,  
                                    data: "{}",  
                                    success: function (data) {  
                                        $("#FieldElevation").val(data.fieldElevation);  
                                    }  
                                });   


                                }  
                            });                             

                                //If you want to do something on the select event, you may do it here
                                //$("#tags").html(ui.item.label);
                            }
                        });

                        $('#RunwayIdentifier').on('change', function() {               
                            if ($("#RunwayIdentifier").val() != -1) {                                
                                $.ajax({
                                    url: '/Home/GetRunwayDetail?airportIdentifier=' + $('#AirportIdentifier').val() + "&runwayId=" + $(this).val(),
                                    type: 'POST',
                                    success: function (response){                      
    
                                        $("#RunwayLength").val(response.runwayLength.valueOf());
                                        
                                        if($("#RunwayIdentifier option:selected").val() == response.runwayIdentifier_Primary.valueOf() )
                                        {
                                            $("#RunwayHeading").val(response.runwayIdentifier_Primary.valueOf().substring(0,2) * 10);
                                        }
                                        else
                                        {
                                            $("#RunwayHeading").val(response.runwayIdentifier_Secondary.valueOf().substring(0,2) * 10);
                                        }

                                    },
                                    error: function (xhr) {
                                        alert("Something went wrong, please try again");
                                    }
                                });
                            }

                        });
                    });
                </script>
            }         


        <div class="col-sm-3">
            <div class="form-floating">
                <input asp-for="RunwayHeading" class="form-control" maxlength="10"
                    data-val-required="Runway Heading is required"/>
                <label asp-for="RunwayHeading">Runway heading °M</label>
            </div>        
        </div>

        <div class="col-sm-3">
            <div class="form-floating">    
                <input asp-for="RunwayLength" class="form-control" maxlength="10" />
                <label asp-for="RunwayLength">Runway length (ft)</label>
            </div>
        </div>

    </div>    
        
    <br />

    <div class="form-group row">

        <div class="col-sm-3">
            <div class="form-floating">   
                <select asp-for="RunwaySurface" class="form-control" >
                    <option value="Paved">Paved</option>          
                </select>
                <label asp-for="RunwaySurface">Runway surface</label>
            </div>    
        </div>   

        <div class="col-sm-3">
            <div class="form-floating">
                <input asp-for="FieldElevation" class="form-control" maxlength="10" 
                    data-val-required="Field Elevation is required" />
                <label asp-for="FieldElevation">Field elevation (ft)</label>
            </div>
        </div>           
    </div>

    <br />

    <div class="form-group row">
        <div class="col-sm-12">
            <button type="submit" style="width: 100%" class="btn btn-primary btn-lg">Calculate Performance</button>
        </div>

    </div>

    <br />

    
    <div class="form-group row">
        <div class="col-sm-6">
            <h5>
                Takeoff
            </h5>
        </div>
        <div class="col-sm-6">
            <h5>
                Landing
            </h5>
        </div>        
    </div>

    <div class="form-group row">
        <div class="col-sm-3">
            <div class="form-floating">  
                @Html.TextBoxFor(s => s.Takeoff_Groundroll_Formatted, "{0:0.00}", new { @readonly="readonly", @class="form-control" })
                <label>Takeoff ground roll</label>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="form-floating">  
                @Html.TextBoxFor(s => s.Takeoff_50FtClearance_Formatted, "{0:0.00}", new { @readonly="readonly", @class="form-control" })
                <label>Distance to clear 50' obstacle</label>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="form-floating">  
                @Html.TextBoxFor(s => s.Landing_Groundroll_Formatted, new { @readonly="readonly", @class="form-control" })
                <label>Landing ground roll</label>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="form-floating">
                @Html.TextBoxFor(s => s.Landing_50FtClearance_Formatted, "{0:0.00}", new { @readonly="readonly", @class="form-control" })
                <label>Distance to clear 50' obstacle</label>
            </div>
        </div>

    </div>

    <br />
    <h5>Other stuff to know</h5>

    <div class="form-group row">
        <div class="col-sm-3">
            <div class="form-floating">
                @Html.TextBoxFor(s => s.CrosswindComponentAbs, "{0:0.00}", new { @readonly="readonly", @class="form-control" })
                <label>@Model.CrosswindComponentText Crosswind</label>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="form-floating">            
                @Html.TextBoxFor(s => s.HeadwindComponentAbs, "{0:0.00}", new { @readonly="readonly", @class="form-control" })
                <label>@Model.HeadwindComponentText</label>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="form-floating">
                @Html.TextBoxFor(s => s.PressureAltitude, "{0:0}", new { @readonly="readonly", @class="form-control" })
                <label>Pressure altitude</label>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="form-floating">
                @Html.TextBoxFor(s => s.DensityAltitude, "{0:0}", new { @readonly="readonly", @class="form-control" })
                <label>Density altitude</label>
            </div>
        </div>
    </div>

</form>

<br />